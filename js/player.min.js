/*************************************
 ***  Created by JZ on 2016/10/04  ***
 ***  JZlayer ver.0.8.10.14        ***
 ************************************/


var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);function newPlayer(A,r){var d=$(A),p=0,b=0,t=0,e=!0,n=0,h=!1,x=!1,u=0,l="",q=360,y=720,m=!1,z=-1,v=!1,w=!1,c={init:function(){d.html('<div id="playerWrap"><div id="YTbox" class="player"></div><div id="TVPbox" class="player"></div></div><nav style="position: relative;"><ul class="controls"><li id="prev"><i class="fa fa-step-backward"></i></li><li id="play" class="paused"><i class="fa fa-play"></i><i class="fa fa-pause"></i></li><li id="next"><i class="fa fa-step-forward"></i></li><li id="time"><span class="current">0:00</span><span> / </span><span class="duration">0:00</span></li><li id="loop" class="right"><i class="fa fa-repeat"></i><span class="single">1</span></li><li id="shuffle" class="right"><i class="fa fa-random"></i></li></ul><div id="timeline"><span class="line"></span><span class="progress"></span><span class="circle"></span></div></nav><ul class="playList"></ul>');p=r.length-1;(function(a){a=a?a.map(function(a,b){return"<li>"+(b+1)+". "+a.title+(a.artist?'<span class="artist">'+a.artist+"</span>":"")+"</li>"}):"";$(".playList").html(a)})(r);(function(){d.on("click","#play",c.togglePlay).on("click","#prev",c.prevVideo).on("click","#next",c.nextVideo).on("click","#shuffle",c.toggleShuffle).on("click","#loop",c.toggleLoop).on("click",".playList li",function(){b=$(this).index();e=!0;c.setCurrentVideo()})})();$(window).on("resize",function(){var a=q/y;setTimeout(function(){var b=parseInt($(window).width());y=720<b?720:b;q=y*a;$("#playerWrap").css("height",q);d.find("iframe").css("height",q)},30)}).trigger("resize");c.setCurrentVideo();c.getCurrentTime();setTimeout(function(){c.seekTime()},10)},setCurrentVideo:function(a){a=a?a:b;$("#time").hide(0);$(".playList li").eq(a).addClass("current").siblings("li").removeClass("current");c.focusCurrent();l=r[a].type;c.stopAll();switch(l){case "youtube":g.init();d.find("#YTbox").show(0).siblings(".player").hide(0);break;case "tvp":f.init(),d.find("#TVPbox").show(0).siblings(".player").hide(0)}},stopAll:function(){v&&g.playToggle("pause");w&&f.playToggle("pause")},nextVideo:function(){if(1==h)b=c.shuffle();else switch(n){case 0:b<p?b++:(b=0,this.id&&"next"==this.id||(e=!1));break;case 1:b<p?b++:b=0}setTimeout(function(){c.setCurrentVideo()},10)},prevVideo:function(){1==h?b=c.shuffle():0==b?b=p:b--;c.setCurrentVideo()},shuffle:function(){for(var a=Math.floor(Math.random()*(p+1));a==b;)a=Math.floor(Math.random()*(p+1));return a},togglePlay:function(){e=!0;"youtube"==l?g.playToggle():"tvp"==l&&f.playToggle()},toggleShuffle:function(){0==h?(h=!h,d.find("#shuffle").addClass("active")):(h=!h,d.find("#shuffle").removeClass("active"))},toggleLoop:function(){2>n?n++:n=0;var a=d.find("#loop");switch(n){case 0:a.attr("class","right");break;case 1:a.addClass("active");break;case 2:a.addClass("single")}},getCurrentTime:function(){setInterval(function(){var a=u,b,c,d,e;switch(l){case "youtube":v&&(t=g.getCurrentTime());break;case "tvp":w&&(t=f.getCurrentTime())}b=String(Math.floor(a/60));c=String(a%60);1==c.length&&(c="0"+c);d=String(Math.floor(t/60));e=String(t%60);1==e.length&&(e="0"+e);$("#time .current").html(d+":"+e);$("#time .duration").html(b+":"+c);x||($("#timeline .circle").css("left",100*t/a+"%"),$("#timeline .progress").css("width",100*t/a+"%"))},200)},setCurrentTime:function(a){switch(l){case "youtube":g.setCurrentTime(a);break;case "tvp":f.setCurrentTime(a)}},seekTime:function(){function a(a){x=!0;g=parseInt(d.width());f=parseInt(d.offset().left);h=f+g;"createTouch"in document?(k=parseInt(a.touches[0].pageX)-f,document.addEventListener("touchmove",b,!1),document.addEventListener("touchend",e,!1)):(k=parseInt(a.pageX)-f,$(document).on({mousemove:b,mouseup:e}));d.find(".circle").css("left",k);d.find(".progress").css("width",k)}function b(a){a.preventDefault();k="createTouch"in document?parseInt(a.touches[0].pageX)-f:parseInt(a.pageX)-f;k>h-f?k=h-f:0>k&&(k=0);d.find(".circle").css("left",k);d.find(".progress").css("width",k)}function e(){c.setCurrentTime(u*k/g);"createTouch"in document?(document.removeEventListener("touchmove",b,!1),document.removeEventListener("touchend",e,!1)):$(document).off({mousemove:b,mouseup:e});x=!1}var d=$("#timeline"),g,f,k,h;if("createTouch"in document)document.getElementById("timeline").addEventListener("touchstart",a,!1);else $("#timeline").on("mousedown",a)},focusCurrent:function(){var a=$(".playList"),c=parseInt(a.scrollTop()),d=$(".playList li").eq(b)[0].offsetTop;a.height(300);h?(c=0>b-2?0:b-2,a.scrollTop($(".playList li").eq(c)[0].offsetTop)):c>d?a.scrollTop(d):c+300-50<=d&&a.scrollTop(d-230)}},f={player:null,params:function(a){return{video:{vid:a},playerType:"html5",width:"auto",height:"auto",autoplay:!1,isSkipLoadingAd:!0,isHtml5AutoBuffer:!0,isHtml5ShowPlayBtnOnPause:!1,isHtml5ShowLoadingAdOnChange:!1,isHtml5ShowLoadingAdOnReplay:!1,isHtml5ShowLoadingAdOnStart:!1,isHtml5UseUI:!1,isContinuePlay:!1,skipLoadingAdTime:0,onwrite:function(){$("#TVPbox").find("video").attr("controls",!1)},oninited:function(){f.player=this;w&&delete tvp.Player.instance["tenvideo_video_player_"+z];z++;w=!0;e&&"tvp"==l&&(f.player.play(),e=!0)},onallended:function(){m="pause";d.find("#play").addClass("paused");2==n?c.setCurrentVideo():(b!=p||0!=n||h||(e=!1),$("#TVPbox").html(""),c.nextVideo())},onplaying:function(){m="play";d.find("#play").removeClass("paused");var a=parseInt(f.player.getDuration());a!=u&&(u=a);q=parseInt($("#TVPbox").height());e=!0;$(window).trigger("resize");$("#time").show(0)},onpause:function(){m="pause";d.find("#play").addClass("paused")},onerror:function(){console.log("\u66f8\u7c64\u5167\u7684\u7b2c "+b+" \u652f\u5f71\u7247\u9023\u7d50\u5df2\u5931\u6548")}}},init:function(){$("#TVPbox").createTVP(f.params(r[b].id))},playToggle:function(a){"play"==m||"pause"==a?f.player.pause():"pause"==m&&f.player.play()},getCurrentTime:function(){return parseInt(f.player.getPlaytime())},setCurrentTime:function(a){f.player.setPlaytime(a)}},g={player:null,params:{autoplay:0,controls:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,iv_load_policy:3,theme:"dark",origin:location.origin},init:function(){v?g.player.cueVideoById({videoId:r[b].id,startSeconds:0}):g.player=new YT.Player("YTbox",{width:"100%",videoId:r[b].id,playerVars:g.params,events:{onStateChange:function(){switch(g.player.getPlayerState()){case 0:m="pause";d.find("#play").addClass("paused");2==n?c.setCurrentVideo():(b!=p||0!=n||h||(e=!1),c.nextVideo());break;case 1:m="play";d.find("#play").removeClass("paused");var a=parseInt(g.player.getDuration());a!=u&&(u=a);q=parseInt($("#YTbox").width())/2;e=!0;$("#YTbox").height(q);$(window).trigger("resize");$("#time").show(0);break;case 2:m="pause";d.find("#play").addClass("paused");break;case 3:e&&"youtube"==l||(g.player.stopVideo(),e=!0);break;case 5:!e||"youtube"!=l||"createTouch"in document||g.player.playVideo()}},onReady:function(){!e||"youtube"!=l||"createTouch"in document||g.player.playVideo();v=!0},onError:function(){console.log("\u66f8\u7c64\u5167\u7684\u7b2c "+b+" \u652f\u5f71\u7247\u9023\u7d50\u5df2\u5931\u6548")}}})},playToggle:function(a){"play"==m||"pause"==a?g.player.pauseVideo():"pause"==m&&g.player.playVideo()},getCurrentTime:function(){return parseInt(g.player.getCurrentTime())},setCurrentTime:function(a){g.player.seekTo(a)}};c.init()};