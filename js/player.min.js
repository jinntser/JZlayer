/*************************************
 ***  Created by JZ on 2016/10/04  ***
 ***  JZlayer ver.0.9.12.05        ***
 ************************************/


(function(c){function C(D,u){var e=c(D),q=0,b=0,v=0,f=!0,p=0,k=!1,z=!1,w=0,m="",r=360,A=720,n=!1,t=-1,x=!1,y=!1,d={init:function(){e.html('<div id="playerWrap"><div id="YTbox" class="player"></div><div id="TVPbox" class="player"></div></div><nav style="position: relative;"><ul class="controls"><li id="prev"><i class="fa fa-step-backward"></i></li><li id="play" class="paused"><i class="fa fa-play"></i><i class="fa fa-pause"></i></li><li id="next"><i class="fa fa-step-forward"></i></li><li id="time"><span class="current">0:00</span><span> / </span><span class="duration">0:00</span></li><li id="loop" class="right"><i class="fa fa-repeat"></i><span class="single">1</span></li><li id="shuffle" class="right"><i class="fa fa-random"></i></li></ul><div id="timeline"><span class="line"></span><span class="progress"></span><span class="circle"></span></div></nav><ul class="playList"></ul>');q=u.length-1;(function(a){a=a?a.map(function(a,c){return"<li>"+(c+1)+". "+a.title+(a.artist?'<span class="artist">'+a.artist+"</span>":"")+"</li>"}):"";c(".playList").html(a)})(u);(function(){e.on("click","#play",d.togglePlay).on("click","#prev",d.prevVideo).on("click","#next",d.nextVideo).on("click","#shuffle",d.toggleShuffle).on("click","#loop",d.toggleLoop).on("click",".playList li",function(){b=c(this).index();f=!0;d.setCurrentVideo()})})();c(window).on("resize",function(){var a=r/A;setTimeout(function(){var b=parseInt(c(window).width());A=720<b?720:b;r=A*a;c("#playerWrap").css("height",r);e.find("iframe").css("height",r)},30)}).trigger("resize");d.setCurrentVideo();d.getCurrentTime();setTimeout(function(){d.seekTime()},10)},setCurrentVideo:function(a){a=a?a:b;c("#time").hide(0);c(".playList li").eq(a).addClass("current").siblings("li").removeClass("current");d.focusCurrent();m=u[a].type;d.stopAll();switch(m){case "youtube":h.init();e.find("#YTbox").show(0).siblings(".player").hide(0);break;case "tvp":g.init(),e.find("#TVPbox").show(0).siblings(".player").hide(0)}},stopAll:function(){x&&h.playToggle("pause");y&&g.playToggle("pause")},nextVideo:function(){if(1==k)b=d.shuffle();else switch(p){case 0:b<q?b++:(b=0,this.id&&"next"==this.id||(f=!1));break;case 1:b<q?b++:b=0}setTimeout(function(){d.setCurrentVideo()},10)},prevVideo:function(){1==k?b=d.shuffle():0==b?b=q:b--;d.setCurrentVideo()},shuffle:function(){for(var a=Math.floor(Math.random()*(q+1));a==b;)a=Math.floor(Math.random()*(q+1));return a},togglePlay:function(){f=!0;"youtube"==m?h.playToggle():"tvp"==m&&g.playToggle()},toggleShuffle:function(){0==k?(k=!k,e.find("#shuffle").addClass("active")):(k=!k,e.find("#shuffle").removeClass("active"))},toggleLoop:function(){2>p?p++:p=0;var a=e.find("#loop");switch(p){case 0:a.attr("class","right");break;case 1:a.addClass("active");break;case 2:a.addClass("single")}},getCurrentTime:function(){setInterval(function(){var a=w,b,d,e,f;switch(m){case "youtube":x&&(v=h.getCurrentTime());break;case "tvp":y&&(v=g.getCurrentTime())}b=String(Math.floor(a/60));d=String(a%60);1==d.length&&(d="0"+d);e=String(Math.floor(v/60));f=String(v%60);1==f.length&&(f="0"+f);c("#time .current").html(e+":"+f);c("#time .duration").html(b+":"+d);z||(c("#timeline .circle").css("left",100*v/a+"%"),c("#timeline .progress").css("width",100*v/a+"%"))},200)},setCurrentTime:function(a){switch(m){case "youtube":h.setCurrentTime(a);break;case "tvp":g.setCurrentTime(a)}},seekTime:function(){function a(a){z=!0;h=parseInt(e.width());g=parseInt(e.offset().left);k=g+h;"createTouch"in document?(l=parseInt(a.touches[0].pageX)-g,document.addEventListener("touchmove",b,!1),document.addEventListener("touchend",f,!1)):(l=parseInt(a.pageX)-g,c(document).on({mousemove:b,mouseup:f}));e.find(".circle").css("left",l);e.find(".progress").css("width",l)}function b(a){a.preventDefault();l="createTouch"in document?parseInt(a.touches[0].pageX)-g:parseInt(a.pageX)-g;l>k-g?l=k-g:0>l&&(l=0);e.find(".circle").css("left",l);e.find(".progress").css("width",l)}function f(){d.setCurrentTime(w*l/h);"createTouch"in document?(document.removeEventListener("touchmove",b,!1),document.removeEventListener("touchend",f,!1)):c(document).off({mousemove:b,mouseup:f});z=!1}var e=c("#timeline"),h,g,l,k;if("createTouch"in document)document.getElementById("timeline").addEventListener("touchstart",a,!1);else c("#timeline").on("mousedown",a)},focusCurrent:function(){var a=c(".playList"),d=parseInt(a.scrollTop()),e=c(".playList li").eq(b)[0].offsetTop;a.height(300);k?(d=0>b-2?0:b-2,a.scrollTop(c(".playList li").eq(d)[0].offsetTop)):d>e?a.scrollTop(e):d+300-50<=e&&a.scrollTop(e-230)}},g={player:null,params:function(a){return{video:{vid:a},playerType:"html5",width:"auto",height:"auto",autoplay:!1,isSkipLoadingAd:!0,isHtml5AutoBuffer:!0,isHtml5ShowPlayBtnOnPause:!1,isHtml5ShowLoadingAdOnChange:!1,isHtml5ShowLoadingAdOnReplay:!1,isHtml5ShowLoadingAdOnStart:!1,isHtml5UseUI:!1,isContinuePlay:!1,skipLoadingAdTime:0,onwrite:function(){c("#TVPbox").find("video").attr("controls",!1)},oninited:function(){g.player=this;y&&delete tvp.Player.instance["tenvideo_video_player_"+t];t++;y=!0;f&&"tvp"==m&&(g.player.play(),f=!0)},onallended:function(){n="pause";e.find("#play").addClass("paused");2==p?d.setCurrentVideo():(b!=q||0!=p||k||(f=!1),c("#TVPbox").html(""),d.nextVideo())},onplaying:function(){n="play";e.find("#play").removeClass("paused");var a=parseInt(g.player.getDuration());a!=w&&(w=a);r=parseInt(c("#TVPbox").height());f=!0;c(window).trigger("resize");c("#time").show(0)},onpause:function(){n="pause";e.find("#play").addClass("paused")},onerror:function(){console.log("\u66f8\u7c64\u5167\u7684\u7b2c "+b+" \u652f\u5f71\u7247\u9023\u7d50\u5df2\u5931\u6548")}}},init:function(){c("#TVPbox").createTVP(g.params(u[b].id))},playToggle:function(a){"play"==n||"pause"==a?g.player.pause():"pause"==n&&g.player.play()},getCurrentTime:function(){return parseInt(g.player.getPlaytime())},setCurrentTime:function(a){g.player.setPlaytime(a)}},h={player:null,params:{autoplay:0,controls:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,iv_load_policy:3,theme:"dark",origin:location.origin},init:function(){x?h.player.cueVideoById({videoId:u[b].id,startSeconds:0}):h.player=new YT.Player("YTbox",{width:"100%",videoId:u[b].id,playerVars:h.params,events:{onStateChange:function(){switch(h.player.getPlayerState()){case 0:n="pause";e.find("#play").addClass("paused");2==p?d.setCurrentVideo():(b!=q||0!=p||k||(f=!1),d.nextVideo());break;case 1:n="play";e.find("#play").removeClass("paused");var a=parseInt(h.player.getDuration());a!=w&&(w=a);r=parseInt(c("#YTbox").width())/2;f=!0;c("#YTbox").height(r);c(window).trigger("resize");c("#time").show(0);break;case 2:n="pause";e.find("#play").addClass("paused");break;case 3:f&&"youtube"==m||(h.player.stopVideo(),f=!0);break;case 5:!f||"youtube"!=m||"createTouch"in document||h.player.playVideo()}},onReady:function(){!f||"youtube"!=m||"createTouch"in document||h.player.playVideo();x=!0},onError:function(){console.log("\u66f8\u7c64\u5167\u7684\u7b2c "+b+" \u652f\u5f71\u7247\u9023\u7d50\u5df2\u5931\u6548")}}})},playToggle:function(a){"play"==n||"pause"==a?h.player.pauseVideo():"pause"==n&&h.player.playVideo()},getCurrentTime:function(){return parseInt(h.player.getCurrentTime())},setCurrentTime:function(a){h.player.seekTo(a)}};d.init()}var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var B=document.getElementsByTagName("script")[0];B.parentNode.insertBefore(t,B);c.fn.extend({JZlayer:function(t){return this.each(function(){C(c(this),t)})}})})(jQuery);